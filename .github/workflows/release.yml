name: Production Release
on:
    workflow_dispatch:
    push: # Update on merge on main branch if the changelog file has been updated
        branches:
            - chore/production-release

jobs:
    bd-deployment:
        name: Database Deployment
        uses: ./.github/workflows/db-prod.yml
        secrets: inherit
    bd-update:
        name: Database Update
        needs: bd-deployment
        uses: ./.github/workflows/db-update-prod.yml
        secrets: inherit
    bash-deployment:
        name: Bash Processes Deployment
        needs: bd-update
        uses: ./.github/workflows/datasets-batch-deployer-prod.yml
        secrets: inherit
    api-deployment:
        name: API Deployment
        needs: bash-deployment
        uses: ./.github/workflows/api-prod.yml
        secrets: inherit
    web-deployment:
        name: Web Deployment
        needs: api-deployment
        uses: ./.github/workflows/web-prod.yml
        secrets: inherit
# GitHub Workflow Documentation

| **Workflow Group**          | **Environment**                                                   | **Description**                                                                                                                                                                                     | **Triggers**                               | **Workflow Dependencies**                                                                                                    | **Failure Sends Slack Message** |
|-----------------------------|-------------------------------------------------------------------|-----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|--------------------------------------------|------------------------------------------------------------------------------------------------------------------------------|---------------------------------|
| **API Deployment**          | DEV                                                               | Deploys the API to [DEV environment](https://api-dev.mobilitydatabase.org/)                                                                                                                         | Manual                                     | Build & Test, Integration Tests                                                                                               |                                 |
|                             | QA                                                                | Deploys the API to [QA environment](https://api-qa.mobilitydatabase.org/)                                                                                                                           | Manual, Workflow Call                      | Build & Test                                                                                                                 |                                 |
|                             | PROD                                                              | Deploys the API to [Production](https://api.mobilitydatabase.org/)                                                                                                                                  | Manual, Workflow Call                      | Build & Test                                                                                                                 |                                 |
| **Build & Test**            | Local                                                             | Runs tests in `api` directory as well as `functions-python`                                                                                                                                         | Pull Request, Workflow Call                |                                                                                                                              |                                 |
| **Dataset Batch Deployment** | DEV                                                               | Deploys the infrastructure Terraform code in `infra/batch` for the DEV environment                                                                                                                  | Merge, Manual                              |                                                                                                                              | ✅                               |
|                             | QA                                                                | Deploys the infrastructure Terraform code in `infra/batch` for the QA environment                                                                                                                   | Manual, Workflow Call                      |                                                                                                                              |                                 |
|                             | PROD                                                              | Deploys the infrastructure Terraform code in `infra/batch` for the PROD environment                                                                                                                 | Manual, Workflow Call                      |                                                                                                                              |                                 |
| **Database Deployment**     | QA                                                                | Deploys the database to QA, which includes the DEV instance; updates DEV secrets as part of this action                                                                                             | Manual, Workflow Call                      |                                                                                                                              |                                 |
|                             | PROD                                                              | Deploys the database instance in PROD                                                                                                                                                               | Manual, Workflow Call                      |                                                                                                                              |                                 |
| **Database Update**         | DEV                                                               | Updates the schema of the DEV database and syncs content with `mobility-database-catalog` repo using `sources.csv`                                                                                  | Merge, Manual, Repository Dispatch         |                                                                                                                              | ✅                               |
|                             | QA                                                                | Same as DEV, but for the QA database                                                                                                                                                                | Workflow Call, Manual, Repository Dispatch |                                                                                                                              | ✅                               |
|                             | PROD                                                              | Same as DEV, but for the PROD database                                                                                                                                                              | Workflow Call, Manual, Repository Dispatch |                                                                                                                              | ✅                               |
| **Integration Tests**       | N/A                                                               | Runs API integration tests on the specified link as input variable                                                                                                                                  | Workflow Call                              |                                                                                                                              |                                 |
| **Integration Tests - PR**  | Local to GitHub runner, QA database | Runs integration tests locally while connecting to the QA database                                                                                                                                  | Pull Request                               |                                                                                                                              |                                 |
| **Release**                 | QA                                                                | Full release for QA                                                                                                                                                                                 | Merge, Manual                              | Database Deployment, Database Update, API Deployment, Dataset Batch Deployment, Integration Tests, Web Deployment             | ✅                               |
|                             | PROD                                                              | Full release for PROD                                                                                                                                                                               | Release                                    | Database Deployment, Database Update, API Deployment, Dataset Batch Deployment, Integration Tests, Web Deployment             | ✅                               |
| **Load Test**               | QA                                                                | Runs load tests for the API                                                                                                                                                                         | Scheduled, Manual                          |                                                                                                                              | ✅                               |
| **TypeScript Generator Check** | Local                                                        | Verifies that TypeScript types generated from `DatabaseCatalogAPI.yaml` match existing types in the repository                                         | Pull Request                               |                                                                                                                              |                                 |
| **Validator Update**        | PROD                                                              | Creates a GCP task to update all validation reports 24 hours after a new version release of the GTFS canonical validator                                                                            | Repository Dispatch                        |                                                                                                                              | ✅                               |
| **Web App Deployer**        | DEV                                                               | Deploys the web app to an environment on demand; posts URL as a comment to the pull request if applicable                                                                                           | Manual, PR                                 |                                                                                                                              |                                 |
|                             | QA                                                                | Deploys the web app to [qa.mobilitydatabase.org](https://qa.mobilitydatabase.org/)                                                                                                                  | Manual, Workflow Call                      |                                                                                                                              |                                 |
|                             | PROD                                                              | Deploys the web app to [mobilitydatabase.org](https://mobilitydatabase.org/)                                                                                                                        | Manual, Workflow Call                      |                                                                                                                              |                                 |

This table documents all GitHub workflows, providing an overview of the workflow groups, environments, descriptions, triggers, dependencies, and Slack notification settings for each.
